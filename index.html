from pyrogram import Client, filters from pyrogram.types import InlineKeyboardMarkup, InlineKeyboardButton, Message, CallbackQuery

app = Client("account_marketplace")

قاعدة بيانات مؤقتة (تُستبدل بقاعدة حقيقية لاحقًا)

accounts = []

الأقسام الرئيسية والتطبيقات التابعة لها

categories = { "ألعاب": ["ببجي", "فري فاير", "كول أوف ديوتي"], "تواصل": ["انستغرام", "سناب شات", "تيليغرام"], "بث مباشر": ["نتفليكس", "شاهد", "OSN"] }

current_filters = { "category": None, "app": None, "price_min": 0, "price_max": 99999, "sort": "الأحدث", "search": "" }

filter_visible = False

الواجهة الرئيسية

@app.on_message(filters.command("start")) async def start(client, message): await show_main_menu(message)

async def show_main_menu(message): keyboard = [ [InlineKeyboardButton("رفع حساب", callback_data="upload")], [InlineKeyboardButton("بحث", switch_inline_query_current_chat="")], [InlineKeyboardButton("فلتر", callback_data="toggle_filter")] ] await message.reply("مرحباً بك في متجر الحسابات، اختر من القائمة:", reply_markup=InlineKeyboardMarkup(keyboard)) await show_accounts(message)

عرض الحسابات مع الفلاتر

async def show_accounts(message): filtered = filter_accounts() text = "" for acc in filtered: text += f"\n**{acc['category']} - {acc['app']}**\nالسعر: {acc['price']}\nالوصف: {acc['desc']}\n» للتواصل مع البائع: {acc['contact']}\n\n" if not text: text = "لا توجد حسابات مطابقة حالياً." await message.reply(text)

رفع حساب جديد

@app.on_callback_query(filters.regex("upload")) async def upload_form(client, callback_query): await callback_query.message.edit_text("أرسل معلومات الحساب بالشكل التالي:\n\nالفئة - التطبيق\nالسعر\nالوصف\nوسيلة التواصل") app.set_parse_mode("Markdown") app.register_next_step_handler(callback_query.message, save_account)

def save_account(message): try: lines = message.text.split("\n") cat_app = lines[0].split(" - ") account = { "category": cat_app[0], "app": cat_app[1], "price": float(lines[1]), "desc": lines[2], "contact": lines[3] } accounts.append(account) app.send_message(message.chat.id, "تم إضافة الحساب بنجاح!") except: app.send_message(message.chat.id, "حدث خطأ بالتنسيق، تأكد من الشكل المطلوب.")

إظهار / إخفاء الفلتر

@app.on_callback_query(filters.regex("toggle_filter")) async def toggle_filter(client, callback_query): global filter_visible filter_visible = not filter_visible if filter_visible: keyboard = [] for cat in categories: keyboard.append([InlineKeyboardButton(cat, callback_data=f"filter_cat:{cat}")]) keyboard.append([InlineKeyboardButton("إخفاء الفلتر", callback_data="toggle_filter")]) await callback_query.message.edit_text("اختر القسم:", reply_markup=InlineKeyboardMarkup(keyboard)) else: await callback_query.message.delete()

تحديد القسم

@app.on_callback_query(filters.regex("filter_cat:(.+)")) async def filter_category(client, callback_query): cat = callback_query.data.split(":")[1] current_filters["category"] = cat current_filters["app"] = None apps = categories[cat] keyboard = [[InlineKeyboardButton(app, callback_data=f"filter_app:{app}")] for app in apps] keyboard.append([InlineKeyboardButton("رجوع", callback_data="toggle_filter")]) await callback_query.message.edit_text(f"اختر تطبيق من {cat}:", reply_markup=InlineKeyboardMarkup(keyboard))

تحديد التطبيق

@app.on_callback_query(filters.regex("filter_app:(.+)")) async def filter_app(client, callback_query): app_name = callback_query.data.split(":")[1] current_filters["app"] = app_name await callback_query.message.edit_text(f"تم اختيار التطبيق: {app_name}\nاكتب /start لعرض النتائج.")

فلترة الحسابات بناءً على الشروط

def filter_accounts(): results = [] for acc in accounts: if current_filters["category"] and acc["category"] != current_filters["category"]: continue if current_filters["app"] and acc["app"] != current_filters["app"]: continue if not (current_filters["price_min"] <= acc["price"] <= current_filters["price_max"]): continue if current_filters["search"] and current_filters["search"].lower() not in acc["desc"].lower(): continue results.append(acc) if current_filters["sort"] == "الأرخص": results.sort(key=lambda x: x["price"]) elif current_filters["sort"] == "الأحدث": results = list(reversed(results)) return results

app.run()


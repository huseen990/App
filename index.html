<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>متجر الحسابات</title>
  <script src="https://cdn.tailwindcss.com"></script>
<!-- Firebase (compat style) -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script> 
</head>
<body class="bg-gray-900 text-white">
  <!-- Header -->
  <div class="p-4 flex items-center justify-between bg-gray-800 shadow">
    <div id="authBox" class="p-4 flex justify-between items-center bg-gray-800">
  <div id="userInfo" class="text-sm text-gray-300 hidden">مرحبًا، <span id="userName"></span></div>
  <button id="loginBtn" onclick="loginWithGoogle()" class="bg-green-600 px-4 py-1 rounded text-sm">تسجيل الدخول</button>
  <button id="logoutBtn" onclick="logout()" class="bg-red-600 px-4 py-1 rounded text-sm hidden">تسجيل الخروج</button>
</div>
    <h1 class="text-xl font-bold">متجر الحسابات</h1>
    <button class="bg-blue-600 px-4 py-2 rounded text-sm">تواصل مع الدعم</button>
  </div>

  <!-- شريط البحث -->
  <div id="searchBar" class="px-4 pt-2 pb-1">
    <input oninput="applyFilters()" type="text" id="searchInput" placeholder="ابحث عن حساب..." class="w-full p-2 rounded bg-gray-800 text-white placeholder-gray-500">
  </div>

  <!-- الفلاتر -->
  <div id="filters" class="px-4 pt-1 pb-3 space-y-2">
    <select id="categoryFilter" onchange="toggleAppFilter(); applyFilters()" class="w-full p-2 rounded bg-gray-800 text-white">
      <option value="">اختر القسم</option>
      <option>قسم الألعاب</option>
      <option>قسم التطبيقات</option>
    </select>

    <select id="appTypeFilter" onchange="applyFilters()" class="w-full p-2 rounded bg-gray-800 text-white hidden">
      <option>TikTok</option>
      <option>Instagram</option>
      <option>Free Fire</option>
    </select>

    <div class="flex justify-between gap-2">
      <select id="sortSelect" onchange="applyFilters()" class="w-1/2 p-2 rounded bg-gray-800 text-white">
        <option value="latest">الأحدث</option>
        <option value="cheapest">الأرخص</option>
        <option value="expensive">الأغلى</option>
      </select>

      <!-- السعر -->
      <div class="w-1/2">
        <label class="block text-gray-300 text-sm mb-1">السعر</label>
        <div class="flex gap-1">
          <input type="number" id="priceMin" oninput="applyFilters()" placeholder="من" class="w-1/2 p-1 rounded bg-gray-700 text-white text-sm">
          <input type="number" id="priceMax" oninput="applyFilters()" placeholder="إلى" class="w-1/2 p-1 rounded bg-gray-700 text-white text-sm">
        </div>
      </div>
    </div>
  </div>
  
  <!-- الرئيسية (ستُملأ تلقائيًا) -->
<div id="mainContent" class="p-4 space-y-3"></div>

<!-- رفع حساب -->
<div id="uploadForm" class="hidden p-4">
  <h2 class="text-lg font-semibold mb-2">رفع حساب جديد</h2>
  <form onsubmit="submitAccount(event)" class="space-y-3">
    <input type="text" id="accountName" placeholder="اسم الحساب" class="w-full p-2 rounded bg-gray-700 text-sm" required />
    <select id="accountCategory" class="w-full p-2 rounded bg-gray-700 text-sm" required>
      <option>قسم الألعاب</option>
      <option>قسم التطبيقات</option>
    </select>
    <select id="accountType" class="w-full p-2 rounded bg-gray-700 text-sm" required>
      <option>PUBG</option>
      <option>Netflix</option>
      <option>Facebook</option>
      <option>Free Fire</option>
      <option>Instagram</option>
    </select>
    <input type="number" id="accountPrice" placeholder="السعر بالدولار" class="w-full p-2 rounded bg-gray-700 text-sm" required />
    <input type="text" id="accountContact" placeholder="يوزر تيليغرام للتواصل" class="w-full p-2 rounded bg-gray-700 text-sm" required />
    <input type="url" id="accountImage" placeholder="رابط صورة الحساب" class="w-full p-2 rounded bg-gray-700 text-sm" required />
    <button class="w-full bg-blue-600 py-2 rounded text-white">نشر الحساب</button>
  </form>
</div>

<!-- تفاصيل الحساب -->
<div id="accountDetails" class="hidden p-4 space-y-3">
  <img id="detailsImage" src="" class="w-full rounded-lg">
  <h2 id="detailsName" class="text-xl font-bold mt-2"></h2>
  <p id="detailsCategory" class="text-sm text-gray-300"></p>
  <p id="detailsType" class="text-sm text-gray-300"></p>
  <p id="detailsPrice" class="text-sm text-gray-300"></p>
  <p id="detailsDate" class="text-sm text-gray-300"></p>
  <div class="flex gap-2 mt-2">
    <a id="detailsContact" target="_blank" class="bg-blue-600 px-4 py-2 rounded text-sm">تواصل مع البائع</a>
    <button class="bg-green-600 px-4 py-2 rounded text-sm">تقديم عرض خاص</button>
    <button onclick="showSection('mainContent')" class="bg-gray-700 px-4 py-2 rounded text-sm">رجوع</button>
  </div>
</div>

<!-- الشريط السفلي -->
<div class="fixed bottom-0 left-0 w-full bg-gray-800 text-white text-xs">
  <div class="flex justify-around items-center p-2">
    <button onclick="showSection('mainContent')" id="nav-main" class="flex flex-col items-center text-blue-400">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 3h18v18H3z"/></svg>
      <span>الرئيسية</span>
    </button>
    <button onclick="showSection('uploadForm')" id="nav-upload" class="flex flex-col items-center">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 4v16m8-8H4"/></svg>
      <span>رفع حساب</span>
    </button>
  </div>
</div>

<!-- السكربت -->
<script>
  const sections = ['mainContent', 'uploadForm', 'accountDetails'];
  const searchBar = document.getElementById("searchBar");
  const filters = document.getElementById("filters");
  const accounts = [];

  function showSection(id) {
    sections.forEach(sec => document.getElementById(sec).classList.add('hidden'));
    document.getElementById(id).classList.remove('hidden');
    if (id === 'mainContent') {
      searchBar.classList.remove('hidden');
      filters.classList.remove('hidden');
    } else {
      searchBar.classList.add('hidden');
      filters.classList.add('hidden');
    }
    document.querySelectorAll('button[id^="nav-"]').forEach(btn => btn.classList.remove('text-blue-400'));
    const navId = id === 'mainContent' ? 'main' : id === 'uploadForm' ? 'upload' : '';
    if (navId) document.getElementById("nav-" + navId).classList.add('text-blue-400');
  }

  function toggleAppFilter() {
    const category = document.getElementById('categoryFilter').value;
    const appFilter = document.getElementById('appTypeFilter');
    appFilter.classList.toggle('hidden', category === '');
  }

  function renderAccounts(list) {
    const container = document.getElementById("mainContent");
    container.innerHTML = '';
    list.forEach((acc, i) => {
      const div = document.createElement("div");
      div.className = "bg-gray-800 p-3 rounded cursor-pointer";
      div.onclick = () => showDetails(i);
      div.innerHTML = `
        <img src="${acc.image}" class="w-full rounded mb-2">
        <h3 class="font-bold text-lg">${acc.name}</h3>
        <p class="text-sm text-gray-300">القسم: ${acc.category} | النوع: ${acc.type} | السعر: ${acc.price}$</p>
      `;
      container.appendChild(div);
    });
  }

  function submitAccount(e) {
  e.preventDefault();
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user) {
    alert("يرجى تسجيل الدخول أولًا");
    return;
  }

  const acc = {
    name: document.getElementById("accountName").value,
    category: document.getElementById("accountCategory").value,
    type: document.getElementById("accountType").value,
    price: document.getElementById("accountPrice").value,
    contact: document.getElementById("accountContact").value,
    image: document.getElementById("accountImage").value,
    date: new Date().toISOString().split('T')[0],
    owner: user.uid,
    ownerName: user.name
  };

  firebase.database().ref("accounts").push(acc).then(() => {
    alert("تم رفع الحساب بنجاح!");
    e.target.reset();
    fetchAccounts();
    showSection("mainContent");
  });
}

  function showDetails(index) {
    const acc = accounts[index];
    document.getElementById("detailsImage").src = acc.image;
    document.getElementById("detailsName").innerText = acc.name;
    document.getElementById("detailsCategory").innerText = `القسم: ${acc.category}`;
    document.getElementById("detailsType").innerText = `النوع: ${acc.type}`;
    document.getElementById("detailsPrice").innerText = `السعر: ${acc.price}$`;
    document.getElementById("detailsDate").innerText = `تاريخ النشر: ${acc.date}`;
    document.getElementById("detailsContact").href = `https://t.me/${acc.contact.replace('@','')}`;
    showSection('accountDetails');
  }

  function applyFilters() {
    const search = document.getElementById("searchInput").value.toLowerCase();
    const cat = document.getElementById("categoryFilter").value;
    const type = document.getElementById("appTypeFilter").value;
    const min = parseFloat(document.getElementById("priceMin").value) || 0;
    const max = parseFloat(document.getElementById("priceMax").value) || Infinity;
    const sort = document.getElementById("sortSelect").value;

    let filtered = accounts.filter(acc => {
      return (
        acc.name.toLowerCase().includes(search) &&
        (cat === "" || acc.category === cat) &&
        (document.getElementById('appTypeFilter').classList.contains('hidden') || acc.type === type) &&
        acc.price >= min && acc.price <= max
      );
    });

    if (sort === "cheapest") filtered.sort((a, b) => a.price - b.price);
    else if (sort === "expensive") filtered.sort((a, b) => b.price - a.price);
    else filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

    renderAccounts(filtered);
  }

  // أول عرض فارغ
  renderAccounts(accounts);
</script>
<script>
  // إعداد firebaseConfig
  const firebaseConfig = {
    apiKey: "AIzaSyB8Ss0MTl-LdAz8qSqufAYApjxEzHlzamc",
    authDomain: "account-store-b0990.firebaseapp.com",
    databaseURL: "https://account-store-b0990-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "account-store-b0990",
    storageBucket: "account-store-b0990.firebasestorage.app",
    messagingSenderId: "849280224042",
    appId: "1:849280224042:web:86003d40172e44b8822c53"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  
  const auth = firebase.auth();

// تسجيل الدخول
function loginWithGoogle() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then(result => {
      const user = result.user;
      localStorage.setItem("user", JSON.stringify({
        name: user.displayName,
        uid: user.uid,
        email: user.email
      }));
      updateAuthUI();
    }).catch(error => {
      alert("فشل تسجيل الدخول: " + error.message);
    });
}

// تسجيل الخروج
function logout() {
  auth.signOut().then(() => {
    localStorage.removeItem("user");
    updateAuthUI();
  });
}

// تحديث واجهة المستخدم
function updateAuthUI() {
  const user = JSON.parse(localStorage.getItem("user"));
  const userInfo = document.getElementById("userInfo");
  const userName = document.getElementById("userName");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");

  if (user) {
    userInfo.classList.remove("hidden");
    userName.textContent = user.name;
    loginBtn.classList.add("hidden");
    logoutBtn.classList.remove("hidden");
    document.getElementById("uploadForm").classList.remove("pointer-events-none", "opacity-50");
  } else {
    userInfo.classList.add("hidden");
    loginBtn.classList.remove("hidden");
    logoutBtn.classList.add("hidden");
    document.getElementById("uploadForm").classList.add("pointer-events-none", "opacity-50");
  }
}

updateAuthUI();

  const sections = [...];
  function showSection(id) { ... }

  const uploadForm = document.getElementById("uploadAccountForm");

  uploadForm.addEventListener("submit", function (e) {
    e.preventDefault();

    const inputs = uploadForm.querySelectorAll("input, select");
    const acc = {
      name: inputs[0].value,
      section: inputs[1].value,
      type: inputs[2].value,
      price: inputs[3].value + "$",
      contact: inputs[4].value,
      date: new Date().toISOString().split("T")[0]
    };

    firebase.database().ref("accounts").push(acc).then(() => {
      alert("تم رفع الحساب بنجاح!");
      e.target.reset();
      fetchAccounts();
      showSection("mainContent");
    });
  });

  const accounts = [];

  function fetchAccounts() {
    firebase.database().ref("accounts").once("value", (snapshot) => {
      accounts.length = 0;
      snapshot.forEach(child => accounts.unshift(child.val()));
      renderAccounts(accounts);
    });
  }

  function renderAccounts(data) {
    const container = document.getElementById("mainContent");
    container.innerHTML = "";
    data.forEach(acc => {
      container.innerHTML += `
        <div class="bg-gray-800 p-3 rounded" onclick="viewDetails('${acc.name}', '${acc.section}', '${acc.type}', '${acc.price}', '${acc.date}', '${acc.contact}')">
          <img src="https://via.placeholder.com/300x150" class="w-full rounded mb-2">
          <h3 class="font-bold text-lg">${acc.name}</h3>
          <p class="text-sm text-gray-300">القسم: ${acc.section} | النوع: ${acc.type} | السعر: ${acc.price}</p>
        </div>
      `;
    });
  }

  function viewDetails(name, section, type, price, date, contact) {
    document.getElementById("accountDetails").classList.remove("hidden");
    document.getElementById("mainContent").classList.add("hidden");

    document.getElementById("accountDetails").innerHTML = `
      <img src="https://via.placeholder.com/400x200" class="w-full rounded-lg">
      <h2 class="text-xl font-bold mt-2">${name}</h2>
      <p class="text-sm text-gray-300">القسم: ${section}</p>
      <p class="text-sm text-gray-300">النوع: ${type}</p>
      <p class="text-sm text-gray-300">السعر: ${price}</p>
      <p class="text-sm text-gray-300">تاريخ النشر: ${date}</p>
      <div class="flex gap-2 mt-2">
        <a href="https://t.me/${contact}" class="bg-blue-600 px-4 py-2 rounded text-sm">تواصل مع البائع</a>
        <button onclick="showSection('mainContent')" class="bg-gray-600 px-4 py-2 rounded text-sm">رجوع</button>
      </div>
    `;
  }

  fetchAccounts();
</script>
  
</body>
                         </html>
